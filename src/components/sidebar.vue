<script setup lang="ts">
import {logout} from "../api/apiLogin.ts";
import router from "../router";
import {useMyAccountStore} from "../stores/myAccountStore";
import {onBeforeMount, ref} from "vue";
import {getAuthenticatedUser} from "../api/apiUser.ts";
import MyAccount from "../types/myAccount.ts";

const myAccountStore = useMyAccountStore();
const myAccount = ref<MyAccount|null>(myAccountStore.getMyAccount());

const firstName = ref(myAccount.value?.firstName);
const lastName = ref(myAccount.value?.lastName);

onBeforeMount(async () => {
  const res = await getAuthenticatedUser();
  if(res){
    myAccountStore.setMyAccount(res);
    myAccount.value = myAccountStore.getMyAccount();
    firstName.value = myAccount.value?.firstName;
    lastName.value = myAccount.value?.lastName;
  }
})


const signOut = () => {
  logout();
  myAccountStore.deleteMyAccount();
  router.push("/login");
}

</script>

<template>
  <div class="flex flex-col text-white w-64 h-screen space-y-10 space-x-10 py-7 pl-2 pt-8 left-60 sticky inset-y-0 transform border-r-2 border-gray-500">
    <router-link to="home" class="text-white flex items-center space-x-2 px-12">
      <img src="../assets/Logoreanmo.svg" alt="Reanmo">
    </router-link>

    <nav class="flex flex-col space-y-1 flex-grow">

      <router-link to="/home" class="flex items-center space-x-2 px-4 py-2.5 rounded-l-[10px] transition duration-200 hover:bg-passwordCard" active-class="active-link">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="white" class="transition duration-200" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 19H9V14C9 13.7167 9.096 13.4793 9.288 13.288C9.48 13.0967 9.71733 13.0007 10 13H14C14.2833 13 14.521 13.096 14.713 13.288C14.905 13.48 15.0007 13.7173 15 14V19H18V10L12 5.5L6 10V19ZM4 19V10C4 9.68333 4.071 9.38333 4.213 9.1C4.355 8.81667 4.55067 8.58333 4.8 8.4L10.8 3.9C11.15 3.63333 11.55 3.5 12 3.5C12.45 3.5 12.85 3.63333 13.2 3.9L19.2 8.4C19.45 8.58333 19.646 8.81667 19.788 9.1C19.93 9.38333 20.0007 9.68333 20 10V19C20 19.55 19.804 20.021 19.412 20.413C19.02 20.805 18.5493 21.0007 18 21H14C13.7167 21 13.4793 20.904 13.288 20.712C13.0967 20.52 13.0007 20.2827 13 20V15H11V20C11 20.2833 10.904 20.521 10.712 20.713C10.52 20.905 10.2827 21.0007 10 21H6C5.45 21 4.97933 20.8043 4.588 20.413C4.19667 20.0217 4.00067 19.5507 4 19Z"/>
        </svg>
        <span>Home</span>
      </router-link>

      <router-link to="/myTweets" class="flex items-center space-x-2 px-4 py-2.5 rounded-l-[10px] transition duration-200 hover:bg-passwordCard" active-class="active-link">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="white" class="transition duration-200" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 12C10.9 12 9.95833 11.6083 9.175 10.825C8.39167 10.0417 8 9.1 8 8C8 6.9 8.39167 5.95833 9.175 5.175C9.95833 4.39167 10.9 4 12 4C13.1 4 14.0417 4.39167 14.825 5.175C15.6083 5.95833 16 6.9 16 8C16 9.1 15.6083 10.0417 14.825 10.825C14.0417 11.6083 13.1 12 12 12ZM4 20V17.2C4 16.6333 4.146 16.1127 4.438 15.638C4.73 15.1633 5.11733 14.8007 5.6 14.55C6.63333 14.0333 7.68333 13.646 8.75 13.388C9.81667 13.13 10.9 13.0007 12 13C13.1 13 14.1833 13.1293 15.25 13.388C16.3167 13.6467 17.3667 14.034 18.4 14.55C18.8833 14.8 19.271 15.1627 19.563 15.638C19.855 16.1133 20.0007 16.634 20 17.2V20H4ZM6 18H18V17.2C18 17.0167 17.9543 16.85 17.863 16.7C17.7717 16.55 17.6507 16.4333 17.5 16.35C16.6 15.9 15.6917 15.5627 14.775 15.338C13.8583 15.1133 12.9333 15.0007 12 15C11.0667 15 10.1417 15.1127 9.225 15.338C8.30833 15.5633 7.4 15.9007 6.5 16.35C6.35 16.4333 6.229 16.55 6.137 16.7C6.045 16.85 5.99933 17.0167 6 17.2V18ZM12 10C12.55 10 13.021 9.80433 13.413 9.413C13.805 9.02167 14.0007 8.55067 14 8C14 7.45 13.8043 6.97933 13.413 6.588C13.0217 6.19667 12.5507 6.00067 12 6C11.45 6 10.9793 6.196 10.588 6.588C10.1967 6.98 10.0007 7.45067 10 8C10 8.55 10.196 9.021 10.588 9.413C10.98 9.805 11.4507 10.0007 12 10Z"/>
        </svg>
        <span>Meine Beitr√§ge</span>
      </router-link>

      <router-link to="/settings" class="flex items-center space-x-2 px-4 py-2.5 rounded-l-[10px] transition duration-200 hover:bg-passwordCard" active-class="active-link">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="white" class="transition duration-200" xmlns="http://www.w3.org/2000/svg">
          <path d="M19.14 12.94C19.18 12.64 19.2 12.33 19.2 12C19.2 11.68 19.18 11.36 19.13 11.06L21.16 9.48C21.2474 9.40789 21.3072 9.30769 21.3291 9.19646C21.351 9.08524 21.3336 8.96986 21.28 8.87L19.36 5.55C19.3034 5.44956 19.2132 5.37237 19.1052 5.33211C18.9972 5.29184 18.8785 5.29109 18.77 5.33L16.38 6.29C15.88 5.91 15.35 5.59 14.76 5.35L14.4 2.81C14.3823 2.69553 14.3241 2.5912 14.236 2.51597C14.1479 2.44074 14.0358 2.39959 13.92 2.4H10.08C9.83996 2.4 9.64996 2.57 9.60996 2.81L9.24996 5.35C8.65996 5.59 8.11996 5.92 7.62996 6.29L5.23996 5.33C5.01996 5.25 4.76996 5.33 4.64996 5.55L2.73996 8.87C2.61996 9.08 2.65996 9.34 2.85996 9.48L4.88996 11.06C4.83996 11.36 4.79996 11.69 4.79996 12C4.79996 12.31 4.81996 12.64 4.86996 12.94L2.83996 14.52C2.75249 14.5921 2.69272 14.6923 2.67084 14.8035C2.64896 14.9148 2.66632 15.0301 2.71996 15.13L4.63996 18.45C4.75996 18.67 5.00996 18.74 5.22996 18.67L7.61996 17.71C8.11996 18.09 8.64996 18.41 9.23996 18.65L9.59996 21.19C9.64996 21.43 9.83996 21.6 10.08 21.6H13.92C14.16 21.6 14.36 21.43 14.39 21.19L14.75 18.65C15.34 18.41 15.88 18.09 16.37 17.71L18.76 18.67C18.98 18.75 19.23 18.67 19.35 18.45L21.27 15.13C21.39 14.91 21.34 14.66 21.15 14.52L19.14 12.94ZM12 15.6C10.02 15.6 8.39996 13.98 8.39996 12C8.39996 10.02 10.02 8.4 12 8.4C13.98 8.4 15.6 10.02 15.6 12C15.6 13.98 13.98 15.6 12 15.6Z"/>
        </svg>
        <span>Einstellungen</span>
      </router-link>
    </nav>

    <div class="">
      <button @click="signOut" class="w-full flex items-center justify-start px-4 py-2.5 rounded-l-[10px] text-white text-opacity-50 transition duration-200 hover:bg-passwordCard">
        <svg class="mr-2" width="24" height="24" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg">
          <g opacity="0.5">
            <path d="M10.3 7.7C10.2074 7.79152 10.1338 7.90052 10.0836 8.02068C10.0334 8.14084 10.0076 8.26977 10.0076 8.4C10.0076 8.53022 10.0334 8.65915 10.0836 8.77931C10.1338 8.89948 10.2074 9.00848 10.3 9.1L12.2 11H3C2.45 11 2 11.45 2 12C2 12.55 2.45 13 3 13H12.2L10.3 14.9C10.2074 14.9915 10.1338 15.1005 10.0836 15.2207C10.0334 15.3408 10.0076 15.4698 10.0076 15.6C10.0076 15.7302 10.0334 15.8592 10.0836 15.9793C10.1338 16.0995 10.2074 16.2085 10.3 16.3C10.69 16.69 11.31 16.69 11.7 16.3L15.29 12.71C15.3827 12.6175 15.4563 12.5076 15.5064 12.3866C15.5566 12.2657 15.5824 12.136 15.5824 12.005C15.5824 11.874 15.5566 11.7443 15.5064 11.6234C15.4563 11.5024 15.3827 11.3925 15.29 11.3L11.7 7.7C11.6085 7.60736 11.4995 7.53381 11.3793 7.48361C11.2592 7.43341 11.1302 7.40756 11 7.40756C10.8698 7.40756 10.7408 7.43341 10.6207 7.48361C10.5005 7.53381 10.3915 7.60736 10.3 7.7ZM20 19H13C12.45 19 12 19.45 12 20C12 20.55 12.45 21 13 21H20C21.1 21 22 20.1 22 19V5C22 3.9 21.1 3 20 3H13C12.45 3 12 3.45 12 4C12 4.55 12.45 5 13 5H20V19Z"/>
          </g>
        </svg>
        <span>Abmelden</span>
      </button>
    </div>


  </div>
</template>

<style>
.active-link {
  background: #002643;
  color: #00ACDF;
  fill: #00ACDF;
}

.active-link svg {
  fill: #00ACDF;
}

</style>